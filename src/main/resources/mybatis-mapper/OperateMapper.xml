<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.OperateMapper">
	
	<select id="NowDateKey" resultType="String">
		SELECT DATE_FORMAT(NOW(6), '%Y%m%d%H%i%s%f')
	</select>
	
	<select id="TallySheetList" parameterType="map" resultType="hashmap">
		SELECT (SELECT case when add_yn = 'Y' then add_name else name end as name FROM tb_account_mapping WHERE type = amv.type) as name, 
			amv.type,
			amv.account_id,
			#{year} as count_year,
			#{month} as count_month,
		   	ifnull(FORMAT(ats.day_1, 0), 0) as day_1,
			ifnull(FORMAT(ats.day_2, 0), 0) as day_2,
			ifnull(FORMAT(ats.day_3, 0), 0) as day_3,
			ifnull(FORMAT(ats.day_4, 0), 0) as day_4,
			ifnull(FORMAT(ats.day_5, 0), 0) as day_5,
			ifnull(FORMAT(ats.day_6, 0), 0) as day_6,
			ifnull(FORMAT(ats.day_7, 0), 0) as day_7,
			ifnull(FORMAT(ats.day_8, 0), 0) as day_8,
			ifnull(FORMAT(ats.day_9, 0), 0) as day_9,
			ifnull(FORMAT(ats.day_10, 0), 0) as day_10,
			ifnull(FORMAT(ats.day_11, 0), 0) as day_11,
			ifnull(FORMAT(ats.day_12, 0), 0) as day_12,
			ifnull(FORMAT(ats.day_13, 0), 0) as day_13,
			ifnull(FORMAT(ats.day_14, 0), 0) as day_14,
			ifnull(FORMAT(ats.day_15, 0), 0) as day_15,
			ifnull(FORMAT(ats.day_16, 0), 0) as day_16,
			ifnull(FORMAT(ats.day_17, 0), 0) as day_17,
			ifnull(FORMAT(ats.day_18, 0), 0) as day_18,
			ifnull(FORMAT(ats.day_19, 0), 0) as day_19,
			ifnull(FORMAT(ats.day_20, 0), 0) as day_20,
			ifnull(FORMAT(ats.day_21, 0), 0) as day_21,
			ifnull(FORMAT(ats.day_22, 0), 0) as day_22,
			ifnull(FORMAT(ats.day_23, 0), 0) as day_23,
			ifnull(FORMAT(ats.day_24, 0), 0) as day_24,
			ifnull(FORMAT(ats.day_25, 0), 0) as day_25,
			ifnull(FORMAT(ats.day_26, 0), 0) as day_26,
			ifnull(FORMAT(ats.day_27, 0), 0) as day_27,
			ifnull(FORMAT(ats.day_28, 0), 0) as day_28,
			ifnull(FORMAT(ats.day_29, 0), 0) as day_29,
			ifnull(FORMAT(ats.day_30, 0), 0) as day_30,
			ifnull(FORMAT(ats.day_31, 0), 0) as day_31
		FROM tb_account_mapping_v2 amv  
		LEFT OUTER JOIN tb_account_tally_sheet ats
		ON ats.account_id = amv.account_id
        AND ats.type = amv.type
		AND ats.count_year = #{year}
		AND ats.count_month = #{month}
		WHERE amv.account_id = #{account_id}
        AND amv.del_yn = 'N'
		ORDER BY amv.type asc
	</select>
	
	<insert id="TallyNowMonthSave" parameterType="map">
		INSERT INTO tb_account_tally_sheet
		(account_id, type, count_year, count_month, day_1, day_2, day_3, day_4, day_5, day_6, day_7, day_8, day_9, day_10, day_11, day_12, day_13, day_14, day_15, day_16, day_17, day_18, day_19, day_20, day_21, day_22, day_23, day_24, day_25, day_26, day_27, day_28, day_29, day_30, day_31)
		VALUES
		(#{account_id}, #{type}, #{count_year}, #{count_month}, #{day_1}, #{day_2}, #{day_3}, #{day_4}, #{day_5}, #{day_6}, #{day_7}, #{day_8}, #{day_9}, #{day_10}, #{day_11}, #{day_12}, #{day_13}
		, #{day_14}, #{day_15}, #{day_16}, #{day_17}, #{day_18}, #{day_19}, #{day_20}, #{day_21}, #{day_22}, #{day_23}, #{day_24}, #{day_25}, #{day_26}, #{day_27}, #{day_28}, #{day_29}, #{day_30}, #{day_31})
		ON DUPLICATE KEY UPDATE
		account_id = #{account_id}, type = #{type}, count_year = #{count_year}, count_month = #{count_month}, 
		day_1 = #{day_1}, day_2 = #{day_2}, day_3 = #{day_3}, day_4 = #{day_4}, day_5 = #{day_5}, day_6 = #{day_6}, day_7 = #{day_7}, day_8 = #{day_8}, day_9 = #{day_9}, day_10 = #{day_10}, 
		day_11 = #{day_11}, day_12 = #{day_12}, day_13 = #{day_13}, day_14 = #{day_14}, day_15 = #{day_15}, day_16 = #{day_16}, day_17 = #{day_17}, day_18 = #{day_18}, day_19 = #{day_19}, day_20 = #{day_20}, 
		day_21 = #{day_21}, day_22 = #{day_22}, day_23 = #{day_23}, day_24 = #{day_24}, day_25 = #{day_25}, day_26 = #{day_26}, day_27 = #{day_27}, day_28 = #{day_28}, day_29 = #{day_29}, day_30 = #{day_30}, day_31 = #{day_31}
	</insert>
	
	<insert id="TallyBeforeMonthSave" parameterType="map">
		INSERT INTO tb_account_tally_sheet
		(account_id, type, count_year, count_month, day_1, day_2, day_3, day_4, day_5, day_6, day_7, day_8, day_9, day_10, day_11, day_12, day_13, day_14, day_15, day_16, day_17, day_18, day_19, day_20, day_21, day_22, day_23, day_24, day_25, day_26, day_27, day_28, day_29, day_30, day_31)
		VALUES
		(#{account_id}, #{type}, #{count_year}, #{count_month}, #{day_1}, #{day_2}, #{day_3}, #{day_4}, #{day_5}, #{day_6}, #{day_7}, #{day_8}, #{day_9}, #{day_10}, #{day_11}, #{day_12}, #{day_13}
		, #{day_14}, #{day_15}, #{day_16}, #{day_17}, #{day_18}, #{day_19}, #{day_20}, #{day_21}, #{day_22}, #{day_23}, #{day_24}, #{day_25}, #{day_26}, #{day_27}, #{day_28}, #{day_29}, #{day_30}, #{day_31})
		ON DUPLICATE KEY UPDATE
		account_id = #{account_id}, type = #{type}, count_year = #{count_year}, count_month = #{count_month}, 
		day_1 = #{day_1}, day_2 = #{day_2}, day_3 = #{day_3}, day_4 = #{day_4}, day_5 = #{day_5}, day_6 = #{day_6}, day_7 = #{day_7}, day_8 = #{day_8}, day_9 = #{day_9}, day_10 = #{day_10}, 
		day_11 = #{day_11}, day_12 = #{day_12}, day_13 = #{day_13}, day_14 = #{day_14}, day_15 = #{day_15}, day_16 = #{day_16}, day_17 = #{day_17}, day_18 = #{day_18}, day_19 = #{day_19}, day_20 = #{day_20}, 
		day_21 = #{day_21}, day_22 = #{day_22}, day_23 = #{day_23}, day_24 = #{day_24}, day_25 = #{day_25}, day_26 = #{day_26}, day_27 = #{day_27}, day_28 = #{day_28}, day_29 = #{day_29}, day_30 = #{day_30}, day_31 = #{day_31}
	</insert>
	
	<select id="PropertiesList" parameterType="map" resultType="hashmap">
		SELECT idx,
	        account_id,
	        purchase_name,
	        item,
	        spec,
	        qty,
	        type,
	        purchase_price,
	        item_img,
	        receipt_img,
	        note,
	        del_yn,
	        DATE_FORMAT(purchase_dt, '%Y-%m-%d') as purchase_dt,
	        DATE_FORMAT(reg_dt, '%Y-%m-%d') as reg_dt,
	        DATE_FORMAT(del_dt, '%Y-%m-%d') as del_dt
		FROM tb_account_property
		WHERE account_id = #{account_id}
	</select>
	
	<insert id="PropertiesSave" parameterType="map">
		INSERT INTO tb_account_property
    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        idx,
	        account_id,
	        purchase_name,
	        item,
	        spec,
	        qty,
	        type,
	        purchase_price,
	        item_img,
	        receipt_img,
	        note,
	        del_yn,
	        <if test="purchase_dt != null and purchase_dt != ''">purchase_dt,</if>
	        <if test="reg_dt != null and reg_dt != ''">reg_dt,</if>
	        <if test="del_dt != null and del_dt != ''">del_dt,</if>
	        depreciation
	    </trim>
	    
	    VALUES
	    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        #{idx},
	        #{account_id},
	        #{purchase_name},
	        #{item},
	        #{spec},
	        #{qty, jdbcType=INTEGER},
	        #{type, jdbcType=INTEGER},
	        #{purchase_price, jdbcType=INTEGER},
	        #{item_img},
	        #{receipt_img},
	        #{note},
	        #{del_yn},
	        <if test="purchase_dt != null and purchase_dt != ''">DATE_FORMAT(#{purchase_dt}, '%Y-%m-%d'),</if>
	        <if test="reg_dt != null and reg_dt != ''">DATE_FORMAT(#{reg_dt}, '%Y-%m-%d'),</if>
	        <if test="del_dt != null and del_dt != ''">DATE_FORMAT(#{del_dt}, '%Y-%m-%d'),</if>
	        #{depreciation}
	    </trim>
	    
	    ON DUPLICATE KEY UPDATE
	    <trim suffixOverrides=",">
	        <if test="idx != null">
	            idx=#{idx},
	        </if>
	        <if test="account_id != null">
	            account_id=#{account_id},
	        </if>
	        <if test="purchase_name != null">
	            purchase_name=#{purchase_name},
	        </if>
	        <if test="item != null">
	            item=#{item},
	        </if>
	        <if test="spec != null">
	            spec=#{spec},
	        </if>
	        <if test="qty != null">
	            qty=#{qty, jdbcType=INTEGER},
	        </if>
	        <if test="type != null">
	            type=#{type, jdbcType=INTEGER},
	        </if>
	        <if test="purchase_price != null">
	            purchase_price=#{purchase_price, jdbcType=INTEGER},
	        </if>
	        <if test="item_img != null">
	            item_img=#{item_img},
	        </if>
	        <if test="receipt_img != null">
	            receipt_img=#{receipt_img},
	        </if>
	        <if test="note != null">
	            note=#{note},
	        </if>
	        <if test="del_yn != null">
	            del_yn=#{del_yn},
	        </if>
	        <if test="purchase_dt != null and purchase_dt != ''">
	            purchase_dt=#{purchase_dt},
	        </if>
	        <if test="reg_dt != null and reg_dt != ''">
	            reg_dt=#{reg_dt},
	        </if>
	        <if test="del_dt != null and del_dt != ''">
	            del_dt=#{del_dt},
	        </if>
	        <if test="depreciation != null and depreciation != ''">
	            depreciation=#{depreciation},
	        </if>
	    </trim>
	</insert>
	
	<select id="HygieneList" parameterType="map" resultType="hashmap">
		SELECT idx,
	        account_id,
	        problem_image,
	        problem_note,
	        clean_image,
	        clean_note,
	        note, 
	        DATE_FORMAT(mod_dt, '%Y-%m-%d') as mod_dt,
	        DATE_FORMAT(reg_dt, '%Y-%m-%d') as reg_dt
		FROM tb_account_hygiene_management
		WHERE account_id = #{account_id}
	</select>
	
	<insert id="HygieneSave" parameterType="map">
		INSERT INTO tb_account_hygiene_management
    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        idx,
	        account_id,
	        problem_image,
	        problem_note,
	        clean_image,
	        clean_note,
	        note,
	        <if test="mod_dt != null and mod_dt != ''">mod_dt,</if>
	        <if test="reg_dt != null and reg_dt != ''">reg_dt,</if>
	    </trim>
	    
	    VALUES
	    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        #{idx},
	        #{account_id},
	        #{problem_image},
	        #{problem_note},
	        #{clean_image},
	        #{clean_note},
	        #{note},
	        <if test="mod_dt != null and mod_dt != ''">DATE_FORMAT(#{mod_dt}, '%Y-%m-%d'),</if>
	        <if test="reg_dt != null and reg_dt != ''">DATE_FORMAT(#{reg_dt}, '%Y-%m-%d'),</if>
	    </trim>
	    
	    ON DUPLICATE KEY UPDATE
	    <trim suffixOverrides=",">
	        <if test="idx != null">
	            idx=#{idx},
	        </if>
	        <if test="account_id != null">
	            account_id=#{account_id},
	        </if>
	        <if test="problem_image != null">
	            problem_image=#{problem_image},
	        </if>
	        <if test="problem_note != null">
	            problem_note=#{problem_note},
	        </if>
	        <if test="clean_image != null">
	            clean_image=#{clean_image},
	        </if>
	        <if test="clean_note != null">
	            clean_note=#{clean_note},
	        </if>
	        <if test="note != null">
	            note=#{note},
	        </if>
	        <if test="mod_dt != null and mod_dt != ''">
	            mod_dt=#{mod_dt},
	        </if>
	        <if test="reg_dt != null and reg_dt != ''">
	            reg_dt=#{reg_dt},
	        </if>
	    </trim>
	</insert>
	
	<select id="HandOverSearch" parameterType="map" resultType="hashmap">
		SELECT account_id,
	        handover_company,
	        handover_name,
	        DATE_FORMAT(handover_dt, '%Y-%m-%d') as handover_dt,
	        acquisition_company,
	        acquisition_name,
	        DATE_FORMAT(acquisition_dt, '%Y-%m-%d') as acquisition_dt,
	        check_team,
	        check_name,
	        handover_location,
	        meal_number,
	        catering_ration,
	        normal_diet,
	        kitchen_member,
	        work_type,
	        order_program_info,
	        ingredients_order_type,
	        inspection_store_type,
	        stock_manage_type,
	        diet_submit_cycle,
	        hygiene_note,
	        hot_issue,
	        program_use_whether,
	        rounding_satis_whether,
	        complain_note,
	        manager_phone,
	        trash_treatment_type,
	        regular_schedule,
	        special_note,
	        DATE_FORMAT(reg_dt, '%Y-%m-%d') as reg_dt,
	        DATE_FORMAT(mod_dt, '%Y-%m-%d') as mod_dt,
	        user_id
		FROM tb_account_handover_management
		WHERE account_id = #{account_id}
	</select>
	
	<insert id="HandOverSave" parameterType="map">
		INSERT INTO tb_account_handover_management
    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        account_id,
	        handover_company,
	        handover_name,
	        <if test="handover_dt != null and handover_dt != ''">handover_dt,</if>
	        acquisition_company,
	        acquisition_name,
	        <if test="acquisition_dt != null and acquisition_dt != ''">acquisition_dt,</if>
	        check_team,
	        check_name,
	        handover_location,
	        meal_number,
	        catering_ration,
	        normal_diet,
	        kitchen_member,
	        work_type,
	        order_program_info,
	        ingredients_order_type,
	        inspection_store_type,
	        stock_manage_type,
	        diet_submit_cycle,
	        hygiene_note,
	        hot_issue,
	        program_use_whether,
	        rounding_satis_whether,
	        complain_note,
	        manager_phone,
	        trash_treatment_type,
	        regular_schedule,
	        special_note,
	        <if test="reg_dt != null and reg_dt != ''">reg_dt,</if>
	        <if test="mod_dt != null and mod_dt != ''">mod_dt,</if>
	        user_id
	    </trim>
	    
	    VALUES
	    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        #{account_id},
	        #{handover_company},
	        #{handover_name},
	        <if test="handover_dt != null and handover_dt != ''">DATE_FORMAT(#{handover_dt}, '%Y-%m-%d'),</if>
	        #{acquisition_company},
	        #{acquisition_name},
	        <if test="acquisition_dt != null and acquisition_dt != ''">DATE_FORMAT(#{acquisition_dt}, '%Y-%m-%d'),</if>
	        #{check_team},
	        #{check_name},
	        #{handover_location},
	        #{meal_number},
	        #{catering_ration},
	        #{normal_diet},
	        #{kitchen_member},
	        #{work_type},
	        #{order_program_info},
	        #{ingredients_order_type},
	        #{inspection_store_type},
	        #{stock_manage_type},
	        #{diet_submit_cycle},
	        #{hygiene_note},
	        #{hot_issue},
	        #{program_use_whether},
	        #{rounding_satis_whether},
	        #{complain_note},
	        #{manager_phone},
	        #{trash_treatment_type},
	        #{regular_schedule},
	        #{special_note},
	        <if test="reg_dt != null and reg_dt != ''">DATE_FORMAT(#{reg_dt}, '%Y-%m-%d'),</if>
	        <if test="mod_dt != null and mod_dt != ''">DATE_FORMAT(#{mod_dt}, '%Y-%m-%d'),</if>
	        #{user_id}
	    </trim>
	    ON DUPLICATE KEY UPDATE
	    <trim suffixOverrides=",">
	        account_id=#{account_id},
	        <if test="handover_company != null">
	        handover_company=#{handover_company},
	        </if>
	        <if test="handover_name != null">
	        handover_name=#{handover_name},
	        </if>
	        <if test="handover_location != null">
	        handover_location=#{handover_location},
	        </if>
	        <if test="meal_number != null">
	        meal_number=#{meal_number},
	        </if>
	        <if test="catering_ration != null">
	        catering_ration=#{catering_ration},
	        </if>
	        <if test="normal_diet != null">
	        normal_diet=#{normal_diet},
	        </if>
	        <if test="kitchen_member != null">
	        kitchen_member=#{kitchen_member},
	        </if>
	        <if test="work_type != null">
	        work_type=#{work_type},
	        </if>
	        <if test="order_program_info != null">
	        order_program_info=#{order_program_info},
	        </if>
	        <if test="ingredients_order_type != null">
	        ingredients_order_type=#{ingredients_order_type},
	        </if>
	        <if test="inspection_store_type != null">
	        inspection_store_type=#{inspection_store_type},
	        </if>
	        <if test="stock_manage_type != null">
	        stock_manage_type=#{stock_manage_type},
	        </if>
	        <if test="diet_submit_cycle != null">
	        diet_submit_cycle=#{diet_submit_cycle},
	        </if>
	        <if test="hygiene_note != null">
	        hygiene_note=#{hygiene_note},
	        </if>
	        <if test="hot_issue != null">
	        hot_issue=#{hot_issue},
	        </if>
	        <if test="program_use_whether != null">
	        program_use_whether=#{program_use_whether},
	        </if>
	        <if test="rounding_satis_whether != null">
	        rounding_satis_whether=#{rounding_satis_whether},
	        </if>
	        <if test="complain_note != null">
	        complain_note=#{complain_note},
	        </if>
	        <if test="manager_phone != null">
	        manager_phone=#{manager_phone},
	        </if>
	        <if test="trash_treatment_type != null">
	        trash_treatment_type=#{trash_treatment_type},
	        </if>
	        <if test="regular_schedule != null">
	        regular_schedule=#{regular_schedule},
	        </if>
	        <if test="special_note != null">
	        special_note=#{special_note},
	        </if>
	        <if test="handover_dt != null and handover_dt != ''">
	        handover_dt=DATE_FORMAT(#{handover_dt}, '%Y-%m-%d'),
	        </if>
	        <if test="acquisition_dt != null and acquisition_dt != ''">
	        acquisition_dt=DATE_FORMAT(#{acquisition_dt}, '%Y-%m-%d'),
	        </if>
	        <if test="user_id != null">
	        user_id=#{user_id},
	        </if>
	        <if test="reg_dt != null and reg_dt != ''">
	        reg_dt=DATE_FORMAT(#{reg_dt}, '%Y-%m-%d'),
	        </if>
	        <if test="mod_dt != null and mod_dt != ''">
	        mod_dt=DATE_FORMAT(#{mod_dt}, '%Y-%m-%d'),
	        </if>
	    </trim>
	</insert>
	
	<select id="AccountMappingList" parameterType="map" resultType="hashmap">
		SELECT *
		FROM tb_account_mapping am
	</select>
	
	<select id="AccountMappingV2List" parameterType="map" resultType="hashmap">
		SELECT amv.account_id,
		amv.type,
		am.name,
		amv.del_yn
		FROM tb_account_mapping am
		JOIN tb_account_mapping_v2 amv
		ON amv.type = am.type
		WHERE amv.account_id = #{account_id}
	</select>
	
	<insert id="AccountMappingSave">
	    INSERT INTO tb_account_mapping_v2
	    (account_id, type, reg_dt, del_dt, del_yn)
	    VALUES
	    (
	        #{account_id}
	        , #{type}
	        , <choose>
	            <when test='del_yn == "N"'>DATE_FORMAT(now(), '%Y-%m-%d')</when>
	            <otherwise>NULL</otherwise>
	        </choose>
	        
	        , <choose>
	            <when test='del_yn == "Y"'>DATE_FORMAT(now(), '%Y-%m-%d')</when>
	            <otherwise>NULL</otherwise>
	        </choose>
	        
	        , #{del_yn, jdbcType=CHAR}
	        
	    )
	    ON DUPLICATE KEY UPDATE
	    account_id = #{account_id}, 
	    type = #{type}, 
	    <if test='del_yn == "N"'>
	        reg_dt = DATE_FORMAT(now(), '%Y-%m-%d'),
	        del_dt = NULL,
	    </if>
	    <if test='del_yn == "Y"'>
	        del_dt = DATE_FORMAT(now(), '%Y-%m-%d'),
	        reg_dt = reg_dt,
	    </if>
	    del_yn = #{del_yn, jdbcType=CHAR}
	    
	</insert>
	
	<insert id="AccountRetailBusinessSave">
	    INSERT INTO tb_account_mapping
	    (type, name, biz_no, ceo_name, tel, bank_name, bank_no, bank_image, biz_image, del_yn, add_yn, add_name)
	    VALUES
	    (
	        #{type},
	        #{name},
	        #{biz_no},
	        #{ceo_name},
	        #{tel},
	        #{bank_name},
	        #{bank_no},
	        #{bank_image},
	        #{biz_image},
	        #{del_yn},
	        #{add_yn}, 
	        #{add_name}
	    )
	    ON DUPLICATE KEY UPDATE
	    type = #{type}, 
	    name = #{name},
	    biz_no = #{biz_no},
	    ceo_name = #{ceo_name},
	    tel = #{tel},
	    bank_name = #{bank_name},
	    bank_no = #{bank_no},
	    bank_image = #{bank_image},
	    biz_image = #{biz_image},
	    del_yn = #{del_yn},
	    add_yn = #{add_yn},
	    add_name = #{add_name}
	</insert>
	
	<select id="AccountRetailBusinessList" parameterType="map" resultType="hashmap">
		SELECT concat(ifnull(count(a.account_name),0), '개 거래처 연결') as account_name,
			   am.type,
			   am.name,
			   am.biz_no,
			   am.ceo_name,
			   am.tel,
			   am.bank_name,
			   am.bank_no,
			   am.bank_image,
			   am.biz_image,
			   am.del_yn,
			   am.add_yn,
			   am.add_name
		FROM tb_account_mapping am
		LEFT OUTER JOIN tb_account_mapping_v2 amv
		ON amv.type = am.type
		LEFT OUTER JOIN tb_account a
		ON a.account_id = amv.account_id
		GROUP BY am.type,
			   am.name,
			   am.biz_no,
			   am.ceo_name,
			   am.tel,
			   am.bank_name,
			   am.bank_no,
			   am.bank_image,
			   am.biz_image,
			   am.del_yn,
			   am.add_yn,
			   am.add_name
	</select>
	
	<select id="AccountMembersFilesList" parameterType="map" resultType="hashmap">
		SELECT am.member_id,
			   am.name,
		       am.position,
               t.doc_id,
               t.doc_type_id,
               t.doc_type_name,
               t.doc_sub_name,
               DATE_FORMAT(t.issue_dt, '%Y-%m-%d') as issue_dt,
		       DATE_FORMAT(t.expiry_dt, '%Y-%m-%d') as expiry_dt,
               t.file_path,
               t.note
		FROM tb_account_members am
		LEFT OUTER JOIN 
        (
        SELECT amf.member_id,
			   amf.doc_id,
		       amft.doc_type_id,
		       amft.doc_type_name,
		       amft.doc_sub_name,
		       DATE_FORMAT(amf.issue_dt, '%Y-%m-%d') as issue_dt,
		       DATE_FORMAT(amf.expiry_dt, '%Y-%m-%d') as expiry_dt,
		       amf.file_path,
		       amf.note
        FROM tb_account_members_files amf
		LEFT OUTER JOIN tb_account_members_files_type amft
		ON amft.doc_type_id = amf.doc_type_id 
        LIMIT 1 
		) t
        ON t.member_id = am.member_id
        WHERE am.account_id = #{account_id}
	</select>
	
	<select id="AccountTypeForFileList" parameterType="map" resultType="hashmap">
		SELECT doc_id,
			   file_path,
			   DATE_FORMAT(issue_dt, '%Y-%m-%d') as issue_dt,
		       DATE_FORMAT(expiry_dt, '%Y-%m-%d') as expiry_dt,
			   doc_type_id,
			   note
		FROM tb_account_members_files
		WHERE member_id = #{member_id}
		AND doc_type_id = #{doc_type_id}
	</select>
	
	<insert id="AccountMembersFilesSave">
	    INSERT INTO tb_account_members_files
	    (member_id, doc_type_id, file_path, issue_dt, expiry_dt, update_dt, user_id, note)
	    VALUES
	    (
	        #{member_id},
	        #{doc_type_id},
	        #{file_path},
	        #{issue_dt},
	        #{expiry_dt},
	        DATE_FORMAT(now(), '%Y-%m-%d'),
	        #{user_id},
	        #{note}
	    )
	    ON DUPLICATE KEY UPDATE
	    member_id = #{member_id},
	    doc_type_id = #{doc_type_id},
	    file_path = #{file_path},
	    issue_dt = #{issue_dt},
	    expiry_dt = #{expiry_dt},
	    update_dt = DATE_FORMAT(now(), '%Y-%m-%d'),
	    user_id = #{user_id},
	    note = #{note}
	</insert>
	
	
	<select id="AccountSubRestaurantList" parameterType="map" resultType="hashmap">
		SELECT a.account_id,
			   a.account_name,
			   a.account_address,
			   move_lunch,
			   move_lunch_tel,
			   sub_restaurant1,
			   sub_restaurant1_tel,
			   sub_restaurant2,
			   sub_restaurant2_tel,
			   sub_restaurant3,
			   sub_restaurant3_tel
		FROM tb_account a
		LEFT OUTER JOIN tb_account_sub_restaurant asr
		ON asr.account_id = a.account_id
		<if test='region != ""'>
	        WHERE a.account_address LIKE #{region}
	    </if>
	</select>
	
	<insert id="AccountSubRestaurantSave" parameterType="map">
	    INSERT INTO tb_account_sub_restaurant
	    (account_id, move_lunch, move_lunch_tel, sub_restaurant1, sub_restaurant1_tel, sub_restaurant2, sub_restaurant2_tel, sub_restaurant3, sub_restaurant3_tel, update_dt, user_id)
	    VALUES
	    (
	        #{account_id},
	        #{move_lunch},
	        #{move_lunch_tel},
	        #{sub_restaurant1},
	        #{sub_restaurant1_tel},
	        #{sub_restaurant2},
	        #{sub_restaurant2_tel},
	        #{sub_restaurant3},
	        #{sub_restaurant3_tel},
	        DATE_FORMAT(now(), '%Y-%m-%d'),
	        #{user_id}
	    )
	    ON DUPLICATE KEY UPDATE
	    account_id = #{account_id},
        move_lunch = #{move_lunch},
        move_lunch_tel = #{move_lunch_tel},
        sub_restaurant1 = #{sub_restaurant1},
        sub_restaurant1_tel = #{sub_restaurant1_tel},
        sub_restaurant2 = #{sub_restaurant2},
        sub_restaurant2_tel = #{sub_restaurant2_tel},
        sub_restaurant3 = #{sub_restaurant3},
        sub_restaurant3_tel = #{sub_restaurant3_tel},
	    update_dt = DATE_FORMAT(now(), '%Y-%m-%d'),
	    user_id = #{user_id}
	</insert>
	
	<select id="AccountMemberWorkSystemList" parameterType="map" resultType="hashmap">
		SELECT *
		FROM tb_account_member_work_system
		WHERE del_yn = 'N'
	</select>
	
	<insert id="AccountMemberWorkSystemSave" parameterType="map">
	    INSERT INTO tb_account_member_work_system
	    (idx, work_system, start_time, end_time, del_yn, reg_dt, mod_dt, user_id)
	    VALUES
	    (
	        #{idx},
	        #{work_system},
	        #{start_time},
	        #{end_time},
	        'N',
	        DATE_FORMAT(now(), '%Y-%m-%d'),
	        null,
	        #{user_id}
	    )
	    ON DUPLICATE KEY UPDATE
	    idx = #{idx},
        work_system = #{work_system},
        start_time = #{start_time},
        end_time = #{end_time},
        del_yn = #{del_yn},
        mod_dt = DATE_FORMAT(now(), '%Y-%m-%d'),
        user_id = #{user_id}
	</insert>
	
	<select id="AccountMemberSheetList" parameterType="map" resultType="hashmap">
		SELECT a.account_name
	 		 , concat(a.account_address, '\n', a.account_address_detail) as account_address
	     	 , am.*
		FROM tb_account_members am
		JOIN tb_account a
		ON am.account_id = a.account_id
		WHERE am.account_id = #{account_id}
		AND am.del_yn = #{del_yn}
	</select>
	
	<select id="AccountMemberAllList" parameterType="map" resultType="map">
		SELECT T.member_id,
		    T.account_id,
			T2.account_name,
		    T.name,
		    T.join_dt,
		    T.del_dt,
		    T.del_yn,
		    T.position_type,
		    T.idx,
		    T.start_time,
		    T.end_time,
		    T.salary,
		    T.relation,
		    T.del_note,
		    T.rct_notice,
		    T.note,
		    T.position_type,
		    T.address,
		    T.rrn,
		    T.account_number,
		    T.phone,
		    T.contract_type,
		    DATE_FORMAT(T.act_join_dt, '%Y-%m-%d') AS act_join_dt,
		    DATE_FORMAT(T.ret_set_dt, '%Y-%m-%d') AS ret_set_dt,
		    DATE_FORMAT(T.national_pension, '%Y-%m-%d') AS national_pension,
		    DATE_FORMAT(T.health_insurance, '%Y-%m-%d') AS health_insurance,
		    DATE_FORMAT(T.industrial_insurance, '%Y-%m-%d') AS industrial_insurance,
		    DATE_FORMAT(T.employment_insurance, '%Y-%m-%d') AS employment_insurance,
		    DATE_FORMAT(T.loss_major_insurances, '%Y-%m-%d') AS loss_major_insurances,
		    T.employment_contract,
		    T.subsidy,
		    T.headoffice_note,
		    T.id,
		    T.bankbook
		FROM tb_account_members T
		JOIN tb_account T2
		ON T.account_id = T2.account_id
		WHERE 1=1
		<if test='del_yn != null'>
			AND T.del_yn = #{del_yn}
 		</if>
		<if test='account_id !=null'>
			AND T.account_id = #{account_id}
 		</if>
 		ORDER BY T.account_id, T.position_type
	</select>
	
	<insert id="AccountMembersSave" parameterType="map">
	    INSERT INTO tb_account_members (
	        member_id,
	        account_id,
	        name,
	        join_dt,
	        del_dt,
	        del_yn,
	        position,
	        idx,
	        start_time,
	        end_time,
	        salary,
	        relation,
	        del_note,
	        rct_notice,
	        note,
	        position_type,
	        address,
	        rrn,
	        account_number,
	        phone,
	        contract_type,
	        act_join_dt,
	        ret_set_dt,
	        national_pension,
	        health_insurance,
	        industrial_insurance,
	        employment_insurance,
	        employment_contract,
	        subsidy,
	        headoffice_note,
	        loss_major_insurances,
	        update_dt,
	        user_id,
	        id,
	        bankbook
	    )
	    VALUES (
	        <choose>
	            <when test="member_id == null or member_id == ''">
	                DATE_FORMAT(NOW(6), '%Y%m%d%H%i%s%f'),
	            </when>
	            <otherwise>#{member_id},</otherwise>
	        </choose>
	
	        #{account_id},
	        #{name},
	
	        <!-- join_dt -->
	        <choose>
	            <when test="join_dt != null and join_dt != ''">
	                DATE_FORMAT(#{join_dt}, '%Y-%m-%d'),
	            </when>
	            <otherwise>null,</otherwise>
	        </choose>
	
	        <!-- del_dt -->
	        <choose>
	            <when test="del_dt != null and del_dt != ''">
	                DATE_FORMAT(#{del_dt}, '%Y-%m-%d'),
	            </when>
	            <otherwise>null,</otherwise>
	        </choose>
	
	        #{del_yn},
	        #{position},
	        #{idx},
	        #{start_time},
	        #{end_time},
	        #{salary},
	        #{relation},
	        #{del_note},
	        #{rct_notice},
	        #{note},
	        #{position_type},
	        #{address},
	        #{rrn},
	        #{account_number},
	        #{phone},
	        #{contract_type},
	
	        <!-- act_join_dt -->
	        <choose>
	            <when test="act_join_dt != null and act_join_dt != ''">
	                DATE_FORMAT(#{act_join_dt}, '%Y-%m-%d'),
	            </when>
	            <otherwise>null,</otherwise>
	        </choose>
	
	        <!-- ret_set_dt -->
	        <choose>
	            <when test="ret_set_dt != null and ret_set_dt != ''">
	                DATE_FORMAT(#{ret_set_dt}, '%Y-%m-%d'),
	            </when>
	            <otherwise>null,</otherwise>
	        </choose>
	
	        #{national_pension},
	        #{health_insurance},
	        #{industrial_insurance},
	        #{employment_insurance},
	        #{employment_contract},
	        #{subsidy},
	        #{headoffice_note},
	        #{loss_major_insurances},
	
	        DATE_FORMAT(NOW(), '%Y-%m-%d'),
	        #{user_id},
	        #{id},
	        #{bankbook}
	    )
	
	    ON DUPLICATE KEY UPDATE
	        member_id = #{member_id},
	        account_id = #{account_id},
	        name = #{name},
	
	        join_dt = <choose>
	            <when test="join_dt != null and join_dt != ''">
	                DATE_FORMAT(#{join_dt}, '%Y-%m-%d')
	            </when>
	            <otherwise>null</otherwise>
	        </choose>,
	
	        del_dt = <choose>
	            <when test="del_dt != null and del_dt != ''">
	                DATE_FORMAT(#{del_dt}, '%Y-%m-%d')
	            </when>
	            <otherwise>null</otherwise>
	        </choose>,
	
	        del_yn = #{del_yn},
	        position = #{position},
	        idx = #{idx},
	        start_time = #{start_time},
	        end_time = #{end_time},
	        salary = #{salary},
	        relation = #{relation},
	        del_note = #{del_note},
	        rct_notice = #{rct_notice},
	        note = #{note},
	        position_type = #{position_type},
	        address = #{address},
	        rrn = #{rrn},
	        account_number = #{account_number},
	        phone = #{phone},
	        contract_type = #{contract_type},
	
	        act_join_dt = <choose>
	            <when test="act_join_dt != null and act_join_dt != ''">
	                DATE_FORMAT(#{act_join_dt}, '%Y-%m-%d')
	            </when>
	            <otherwise>null</otherwise>
	        </choose>,
	
	        ret_set_dt = <choose>
	            <when test="ret_set_dt != null and ret_set_dt != ''">
	                DATE_FORMAT(#{ret_set_dt}, '%Y-%m-%d')
	            </when>
	            <otherwise>null</otherwise>
	        </choose>,
	
	        national_pension = #{national_pension},
	        health_insurance = #{health_insurance},
	        industrial_insurance = #{industrial_insurance},
	        employment_insurance = #{employment_insurance},
	        employment_contract = #{employment_contract},
	        subsidy = #{subsidy},
	        headoffice_note = #{headoffice_note},
	        loss_major_insurances = #{loss_major_insurances},
	
	        update_dt = DATE_FORMAT(NOW(), '%Y-%m-%d'),
	        user_id = #{user_id},
	        id = #{id},
	        bankbook = #{bankbook}
	</insert>
	
	<select id="AccountRecMemberList" parameterType="map" resultType="map">
		SELECT T.member_id,
		    T.account_id,
			T2.account_name,
		    T.name,
		    T.position_type,
		    T.idx,
		    T.start_time,
		    T.end_time,
		    T.salary,
		    T.note,
		    T.position_type,
		    T.address,
		    T.rrn,
		    T.account_number,
		    T.phone,
		    T.contract_type,
		    DATE_FORMAT(T.act_join_dt, '%Y-%m-%d') AS act_join_dt,
		    T.employment_contract,
		    T.id,
		    T.bankbook,
		    T.use_yn
		FROM tb_account_rec_management T
		JOIN tb_account T2
		ON T.account_id = T2.account_id
		WHERE 1=1
		<if test='use_yn !=null'>
			AND T.use_yn = #{use_yn}
 		</if>
		<if test='account_id !=null'>
			AND T.account_id = #{account_id}
 		</if>
 		ORDER BY T.account_id, T.position_type
	</select>
	
	<insert id="AccountRecMembersSave" parameterType="map">
	    INSERT INTO tb_account_rec_management (
	        member_id,
	        account_id,
	        name,
	        position,
	        idx,
	        start_time,
	        end_time,
	        salary,
	        note,
	        position_type,
	        address,
	        rrn,
	        account_number,
	        phone,
	        contract_type,
	        act_join_dt,
	        employment_contract,
	        id,
	        bankbook,
	        use_yn,
	        update_dt,
	        user_id
	    )
	    VALUES (
	        <choose>
	            <when test="member_id == null or member_id == ''">
	                DATE_FORMAT(NOW(6), '%Y%m%d%H%i%s%f'),
	            </when>
	            <otherwise>#{member_id},</otherwise>
	        </choose>
	        #{account_id},
	        #{name},
	        #{position},
	        #{idx},
	        #{start_time},
	        #{end_time},
	        #{salary},
	        #{note},
	        #{position_type},
	        #{address},
	        #{rrn},
	        #{account_number},
	        #{phone},
	        #{contract_type},
	
	        <!-- act_join_dt -->
	        <choose>
	            <when test="act_join_dt != null and act_join_dt != ''">
	                DATE_FORMAT(#{act_join_dt}, '%Y-%m-%d'),
	            </when>
	            <otherwise>null,</otherwise>
	        </choose>
	
	        #{employment_contract},
	        #{id},
	        #{bankbook},
	        #{use_yn},
	        DATE_FORMAT(NOW(), '%Y-%m-%d'),
	        #{user_id}
	    )
	
	    ON DUPLICATE KEY UPDATE
	        member_id = #{member_id},
	        account_id = #{account_id},
	        name = #{name},
	        position = #{position},
	        idx = #{idx},
	        start_time = #{start_time},
	        end_time = #{end_time},
	        salary = #{salary},
	        note = #{note},
	        position_type = #{position_type},
	        address = #{address},
	        rrn = #{rrn},
	        account_number = #{account_number},
	        phone = #{phone},
	        contract_type = #{contract_type},
	
	        act_join_dt = <choose>
	            <when test="act_join_dt != null and act_join_dt != ''">
	                DATE_FORMAT(#{act_join_dt}, '%Y-%m-%d')
	            </when>
	            <otherwise>null</otherwise>
	        </choose>,
			use_yn = #{use_yn},
	        employment_contract = #{employment_contract},
	        id = #{id},
	        bankbook = #{bankbook},
	        update_dt = DATE_FORMAT(NOW(), '%Y-%m-%d'),
	        user_id = #{user_id}
	</insert>
	
	<select id="AccountDispatchMemberAllList" parameterType="map" resultType="map">
		SELECT
			  T.account_id,
			  T.member_id,
			  T.name,
			  DATE_FORMAT(T.del_dt, '%Y-%m-%d') AS del_dt,
			  T.del_yn,
			  T.rrn,
			  TRIM(REGEXP_REPLACE(T.account_number, '[가-힣]+', '')) AS account_number,
			  REGEXP_SUBSTR(T.account_number, '[가-힣]+') AS bank_name,
			  T.note,
			  T.type,
			  COUNT(R.record_date) AS work_cnt,
			  COALESCE(SUM(R.salary), 0) AS salary_sum,
			  MAX(CASE WHEN R.record_date = 1  THEN '✅' END) AS `1`,
			  MAX(CASE WHEN R.record_date = 1  THEN R.salary END) AS `1Salary`,
			  MAX(CASE WHEN R.record_date = 2  THEN '✅' END) AS `2`,
			  MAX(CASE WHEN R.record_date = 2  THEN R.salary END) AS `2Salary`,
			  MAX(CASE WHEN R.record_date = 3  THEN '✅' END) AS `3`,
			  MAX(CASE WHEN R.record_date = 3  THEN R.salary END) AS `3Salary`,
			  MAX(CASE WHEN R.record_date = 4  THEN '✅' END) AS `4`,
			  MAX(CASE WHEN R.record_date = 4  THEN R.salary END) AS `4Salary`,
			  MAX(CASE WHEN R.record_date = 5  THEN '✅' END) AS `5`,
			  MAX(CASE WHEN R.record_date = 5  THEN R.salary END) AS `5Salary`,
			  MAX(CASE WHEN R.record_date = 6  THEN '✅' END) AS `6`,
			  MAX(CASE WHEN R.record_date = 6  THEN R.salary END) AS `6Salary`,
			  MAX(CASE WHEN R.record_date = 7  THEN '✅' END) AS `7`,
			  MAX(CASE WHEN R.record_date = 7  THEN R.salary END) AS `7Salary`,
			  MAX(CASE WHEN R.record_date = 8  THEN '✅' END) AS `8`,
			  MAX(CASE WHEN R.record_date = 8  THEN R.salary END) AS `8Salary`,
			  MAX(CASE WHEN R.record_date = 9  THEN '✅' END) AS `9`,
			  MAX(CASE WHEN R.record_date = 9  THEN R.salary END) AS `9Salary`,
			  MAX(CASE WHEN R.record_date = 10 THEN '✅' END) AS `10`,
			  MAX(CASE WHEN R.record_date = 10 THEN R.salary END) AS `10Salary`,
			  MAX(CASE WHEN R.record_date = 11 THEN '✅' END) AS `11`,
			  MAX(CASE WHEN R.record_date = 11 THEN R.salary END) AS `11Salary`,
			  MAX(CASE WHEN R.record_date = 12 THEN '✅' END) AS `12`,
			  MAX(CASE WHEN R.record_date = 12 THEN R.salary END) AS `12Salary`,
			  MAX(CASE WHEN R.record_date = 13 THEN '✅' END) AS `13`,
			  MAX(CASE WHEN R.record_date = 13 THEN R.salary END) AS `13Salary`,
			  MAX(CASE WHEN R.record_date = 14 THEN '✅' END) AS `14`,
			  MAX(CASE WHEN R.record_date = 14 THEN R.salary END) AS `14Salary`,
			  MAX(CASE WHEN R.record_date = 15 THEN '✅' END) AS `15`,
			  MAX(CASE WHEN R.record_date = 15 THEN R.salary END) AS `15Salary`,
			  MAX(CASE WHEN R.record_date = 16 THEN '✅' END) AS `16`,
			  MAX(CASE WHEN R.record_date = 16 THEN R.salary END) AS `16Salary`,
			  MAX(CASE WHEN R.record_date = 17 THEN '✅' END) AS `17`,
			  MAX(CASE WHEN R.record_date = 17 THEN R.salary END) AS `17Salary`,
			  MAX(CASE WHEN R.record_date = 18 THEN '✅' END) AS `18`,
			  MAX(CASE WHEN R.record_date = 18 THEN R.salary END) AS `18Salary`,
			  MAX(CASE WHEN R.record_date = 19 THEN '✅' END) AS `19`,
			  MAX(CASE WHEN R.record_date = 19 THEN R.salary END) AS `19Salary`,
			  MAX(CASE WHEN R.record_date = 20 THEN '✅' END) AS `20`,
			  MAX(CASE WHEN R.record_date = 20 THEN R.salary END) AS `20Salary`,
			  MAX(CASE WHEN R.record_date = 21 THEN '✅' END) AS `21`,
			  MAX(CASE WHEN R.record_date = 21 THEN R.salary END) AS `21Salary`,
			  MAX(CASE WHEN R.record_date = 22 THEN '✅' END) AS `22`,
			  MAX(CASE WHEN R.record_date = 22 THEN R.salary END) AS `22Salary`,
			  MAX(CASE WHEN R.record_date = 23 THEN '✅' END) AS `23`,
			  MAX(CASE WHEN R.record_date = 23 THEN R.salary END) AS `23Salary`,
			  MAX(CASE WHEN R.record_date = 24 THEN '✅' END) AS `24`,
			  MAX(CASE WHEN R.record_date = 24 THEN R.salary END) AS `24Salary`,
			  MAX(CASE WHEN R.record_date = 25 THEN '✅' END) AS `25`,
			  MAX(CASE WHEN R.record_date = 25 THEN R.salary END) AS `25Salary`,
			  MAX(CASE WHEN R.record_date = 26 THEN '✅' END) AS `26`,
			  MAX(CASE WHEN R.record_date = 26 THEN R.salary END) AS `26Salary`,
			  MAX(CASE WHEN R.record_date = 27 THEN '✅' END) AS `27`,
			  MAX(CASE WHEN R.record_date = 27 THEN R.salary END) AS `27Salary`,
			  MAX(CASE WHEN R.record_date = 28 THEN '✅' END) AS `28`,
			  MAX(CASE WHEN R.record_date = 28 THEN R.salary END) AS `28Salary`,
			  MAX(CASE WHEN R.record_date = 29 THEN '✅' END) AS `29`,
			  MAX(CASE WHEN R.record_date = 29 THEN R.salary END) AS `29Salary`,
			  MAX(CASE WHEN R.record_date = 30 THEN '✅' END) AS `30`,
			  MAX(CASE WHEN R.record_date = 30 THEN R.salary END) AS `30Salary`,
			  MAX(CASE WHEN R.record_date = 31 THEN '✅' END) AS `31`,
			  MAX(CASE WHEN R.record_date = 31 THEN R.salary END) AS `31Salary`
			FROM tb_account_members_dispatch T
			LEFT JOIN (
			  SELECT
			    account_id,
			    member_id,
			    record_year,
			    record_month,
			    record_date,
			    MAX(salary) AS salary
			  FROM tb_account_record_dispatch
			  WHERE record_year = #{year}
			    AND record_month = #{month}
			  GROUP BY account_id, member_id, record_year, record_month, record_date
			) R
			  ON R.account_id = T.account_id
			 AND R.member_id  = T.member_id
			WHERE T.del_yn = #{del_yn}
			  AND T.account_id = #{account_id}
			GROUP BY
			  T.account_id, T.member_id, T.name,
			  T.del_dt, T.del_yn, T.rrn, T.account_number, T.note, T.type
			ORDER BY T.account_id, T.member_id
	</select>
	
	<insert id="AccountDispatchMembersSave" parameterType="map">
	    INSERT INTO tb_account_members_dispatch (
	        member_id,
	        account_id,
	        name,
	        del_dt,
	        del_yn,
	        rrn,
	        account_number,
	        note,
	        type
	    )
	    VALUES (
	        <choose>
	            <when test="member_id == null or member_id == ''">
	                DATE_FORMAT(NOW(6), '%Y%m%d%H%i%s%f'),
	            </when>
	            <otherwise>#{member_id},</otherwise>
	        </choose>
	
	        #{account_id},
	        #{name},
	        <!-- del_dt -->
	        <choose>
	            <when test="del_dt != null and del_dt != ''">
	                DATE_FORMAT(#{del_dt}, '%Y-%m-%d'),
	            </when>
	            <otherwise>null,</otherwise>
	        </choose>
	
	        #{del_yn},
	        #{rrn},
	        #{account_number},
	        #{note},
	        #{type}
	    )
	
	    ON DUPLICATE KEY UPDATE
	        member_id = #{member_id},
	        account_id = #{account_id},
	        name = #{name},
	
	        del_dt = <choose>
	            <when test="del_dt != null and del_dt != ''">
	                DATE_FORMAT(#{del_dt}, '%Y-%m-%d')
	            </when>
	            <otherwise>null</otherwise>
	        </choose>,
	
	        del_yn = #{del_yn},
	        rrn = #{rrn},
	        account_number = #{account_number},
	        note = #{note},
	        type = #{type}
	</insert>

	<select id="AccountDinnersNumberList" parameterType="map" resultType="hashmap">
		SELECT *
		FROM tb_account_diners_number
		WHERE account_id = #{account_id}
		AND diner_year = #{year}
		AND diner_month = #{month}
	</select>
	
	<insert id="AccountDinnersNumberSave" parameterType="map">
		INSERT INTO tb_account_diners_number
    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        account_id,
	        diner_year,
	        diner_month,
	        diner_date,
	        breakfast,
	        lunch,
	        dinner,
	        daycare_lunch,
	        daycare_diner,
	        employ,
	        note,
	        total,
	        breakcancel,
	        lunchcancel,
	        dinnercancel,
	        ceremony,
	        extra_diet1_price,
	        extra_diet2_price,
	        extra_diet3_price,
	        extra_diet4_price,
	        extra_diet5_price,
	        special_yn,
	        ceremony2,
	        daycare_breakfast,
	        employ_breakfast,
	        employ_lunch,
	        employ_dinner,
	        breakfast2,
	        lunch2,
	        dinner2,
	        daycare_elderly_lunch,
	        daycare_elderly_dinner,
	        daycare_employ_breakfast,
	        daycare_employ_lunch,
	        daycare_employ_dinner,
	        working_day
	    </trim>
	    
	    VALUES
	    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        #{account_id},
	        #{diner_year},
	        #{diner_month},
	        #{diner_date},
	        #{breakfast},
	        #{lunch},
	        #{dinner},
	        #{daycare_lunch},
	        #{daycare_diner},
	        #{employ},
	        #{note},
	        #{total},
	        #{breakcancel},
	        #{lunchcancel},
	        #{dinnercancel},
	        #{ceremony},
	        #{extra_diet1_price},
	        #{extra_diet2_price},
	        #{extra_diet3_price},
	        #{extra_diet4_price},
	        #{extra_diet5_price},
	        #{special_yn},
	        #{ceremony2},
	        #{daycare_breakfast},
	        #{employ_breakfast},
	        #{employ_lunch},
	        #{employ_dinner},
	        #{breakfast2},
	        #{lunch2},
	        #{dinner2},
	        #{daycare_elderly_lunch},
	        #{daycare_elderly_dinner},
	        #{daycare_employ_breakfast},
	        #{daycare_employ_lunch},
	        #{daycare_employ_dinner},
	        #{working_day}
	    </trim>
	    ON DUPLICATE KEY UPDATE
	    <trim suffixOverrides=",">
	        account_id=#{account_id},
	        diner_year=#{diner_year},
	        diner_month=#{diner_month},
	        diner_date=#{diner_date},
	        breakfast=#{breakfast},
	        lunch=#{lunch},
	        dinner=#{dinner},
	        daycare_lunch=#{daycare_lunch},
	        daycare_diner=#{daycare_diner},
	        employ=#{employ},
	        note=#{note},
	        total=#{total},
	        breakcancel=#{breakcancel},
	        lunchcancel=#{lunchcancel},
	        dinnercancel=#{dinnercancel},
	        ceremony=#{ceremony},
	        extra_diet1_price=#{extra_diet1_price},
	        extra_diet2_price=#{extra_diet2_price},
	        extra_diet3_price=#{extra_diet3_price},
	        extra_diet4_price=#{extra_diet4_price},
	        extra_diet5_price=#{extra_diet5_price},
	        special_yn=#{special_yn},
	        ceremony2=#{ceremony2},
	        daycare_breakfast=#{daycare_breakfast},
	        employ_breakfast=#{employ_breakfast},
	        employ_lunch=#{employ_lunch},
	        employ_dinner=#{employ_dinner},
	        breakfast2=#{breakfast2},
	        lunch2=#{lunch2},
	        dinner2=#{dinner2},
	        daycare_elderly_lunch=#{daycare_elderly_lunch},
	        daycare_elderly_dinner=#{daycare_elderly_dinner},
	        daycare_employ_breakfast=#{daycare_employ_breakfast},
	        daycare_employ_lunch=#{daycare_employ_lunch},
	        daycare_employ_dinner=#{daycare_employ_dinner},
	        working_day=#{working_day}
	    </trim>
	</insert>
	
	<select id="BudgetStandardList" parameterType="map" resultType="map">
		SELECT CASE WHEN meal_type = 1 THEN '요양주간'
					WHEN meal_type = 2 THEN '요양직원'
					WHEN meal_type = 3 THEN '요양'
					WHEN meal_type = 4 THEN '주간보호' 
					ELSE '산업체' END AS meal_type,
			   standard
		FROM tb_account_budget_standard
	</select>
	
	<select id="MealsNumberList" parameterType="map" resultType="map">
		SELECT CASE WHEN account_type = 1 THEN '위탁급식'
					WHEN account_type = 4 THEN '산업체'
					WHEN account_type = 5 THEN '학교' ELSE '' END AS account_type,
			   meals_number
		FROM tb_account_meals_number
	</select>
	
	<select id="BudgetManageMentList" parameterType="map" resultType="map">
		SELECT a.account_id,
			   a.account_name,
			   CASE WHEN a.account_type = 1 THEN '요양원'
			   		WHEN a.account_type = 4 THEN '산업체'
			   		WHEN a.account_type = 5 THEN '학교'
			   		ELSE '' END as account_type_name,
			   CASE WHEN a.meal_type = 1 THEN '요양주간'
			   		WHEN a.meal_type = 2 THEN '요양지원'
			   		WHEN a.meal_type = 3 THEN '요양'
			   		WHEN a.meal_type = 4 THEN '주간보호'
			   		ELSE '산업체' END as meal_type_name,
			   abm.year,
			   abm.month,
			   abm.total,
			   abm.diet_price,
			   abm.utility_bills,
			   abm.food_budget,
			   abm.budget_total,
			   abm.day_budget,
			   abm.day_use_amount,
			   abm.use_ratio,
			   abm.note,
			   abm.budget_grant,
			   abm.day_use_ratio,
			   abm.existing_budget,
			   abm.diff_amount
		FROM tb_account a
		LEFT OUTER JOIN tb_account_budget_management abm
		ON abm.account_id = a.account_id
		AND abm.year = #{year}
		AND abm.month = #{month}
	</select>
	
	<select id="BudgetTotalSave" statementType="CALLABLE" parameterType="map">
	    { CALL BudgetTotalSave(
	        #{year, mode=IN, jdbcType=INTEGER},
	        #{month, mode=IN, jdbcType=INTEGER},
	        #{account_id, mode=IN, jdbcType=VARCHAR},
	        #{result, mode=OUT, jdbcType=INTEGER}
	    ) }
	</select>
	
	<insert id="BudgetTableSave" parameterType="map">
	    INSERT INTO tb_account_budget_management (
	        year,
	        month,
	        account_id,
	        total,
	        diet_price,
	        utility_bills,
	        food_budget,
	        budget_total,
	        day_budget,
	        day_use_amount,
	        use_ratio,
	        note,
	        budget_grant,
	        day_use_ratio,
	        existing_budget,
	        diff_amount,
	        update_dt
	    )
	    VALUES
	    (
	        #{year},
	        #{month},
	        #{account_id},
	        #{total},
	        #{diet_price},
	        #{utility_bills},
	        #{food_budget},
	        #{budget_total},
	        #{day_budget},
	        #{day_use_amount},
	        #{use_ratio},
	        #{note},
	        #{budget_grant},
	        #{day_use_ratio},
	        #{existing_budget},
	        #{diff_amount},
	        DATE_FORMAT(NOW(), '%Y-%m-%d')
	    )
	    ON DUPLICATE KEY UPDATE
	    <trim suffixOverrides=",">
	        <if test="total != null">
	            total = #{total},
	        </if>
	        <if test="diet_price != null">
	            diet_price = #{diet_price},
	        </if>
	        <if test="utility_bills != null">
	            utility_bills = #{utility_bills},
	        </if>
	        <if test="food_budget != null">
	            food_budget = #{food_budget},
	        </if>
	        <if test="budget_total != null">
	            budget_total = #{budget_total},
	        </if>
	        <if test="day_budget != null">
	            day_budget = #{day_budget},
	        </if>
	        <if test="day_use_amount != null">
	            day_use_amount = #{day_use_amount},
	        </if>
	        <if test="use_ratio != null">
	            use_ratio = #{use_ratio},
	        </if>
	        <if test="note != null">
	            note = #{note},
	        </if>
	        <if test="budget_grant != null">
	            budget_grant = #{budget_grant},
	        </if>
	        <if test="day_use_ratio != null">
	            day_use_ratio = #{day_use_ratio},
	        </if>
	        <if test="existing_budget != null">
	            existing_budget = #{existing_budget},
	        </if>
	        <if test="diff_amount != null">
	            diff_amount = #{diff_amount},
	        </if>
	        update_dt = DATE_FORMAT(NOW(), '%Y-%m-%d')
	    </trim>
	</insert>
	
	<select id="AnnualLeaveList" parameterType="map" resultType="map">
		SELECT ledger_id,
			   member_id,
			   DATE_FORMAT(ledger_dt, '%Y-%m-%d') AS ledger_dt,
			   type,
			   days,
			   reason
		FROM tb_account_annual_leave_ledger
		WHERE member_id = #{member_id}
		ORDER BY ledger_dt DESC, 
					CASE WHEN type = 'G' THEN 1
						 WHEN type = 'U' THEN 2
						 WHEN type = 'N' THEN 3
						 ELSE 4 END
	</select>
	
	<select id="OverTimeList" parameterType="map" resultType="map">
		SELECT over_id,
			   member_id,
			   DATE_FORMAT(over_dt, '%Y-%m-%d') AS over_dt,
			   type,
			   times,
			   reason
		FROM tb_account_overtime_ledger
		WHERE member_id = #{member_id}
		ORDER BY over_dt DESC, 
					CASE WHEN type = 'G' THEN 1
						 WHEN type = 'U' THEN 2
						 WHEN type = 'N' THEN 3
						 ELSE 4 END
	</select>
	
	<select id="OperateMemberList" resultType="hashmap">
		SELECT * FROM tb_user
		WHERE department = 5
		AND del_yn = 'N'
		ORDER BY position ASC
	</select>
	
	<select id="OperateScheduleList" parameterType="map" resultType="hashmap">
    	SELECT oc.idx,
    		   DATE_FORMAT(oc.start_date, '%Y-%m-%d') as start_date,
    		   DATE_FORMAT(oc.end_date, '%Y-%m-%d') as end_date,
    		   oc.content,
    		   oc.type,
    		   oc.del_yn,
    		   oc.update_dt,
    		   oc.reg_dt,
    		   oc.user_id,
    		   oc.reg_user_id,
    		   u.user_name
			FROM tb_operate_calendar oc
			JOIN tb_user u
			ON u.user_id = oc.user_id 
			WHERE DATE_FORMAT(oc.start_date, '%Y-%m') = CONCAT(#{year},'-',#{month})
			AND DATE_FORMAT(oc.end_date, '%Y-%m') = CONCAT(#{year},'-',#{month})
    </select>
    
    <select id="OperateScheduleTodayList" parameterType="map" resultType="hashmap">
    	SELECT oc.idx,
    		   DATE_FORMAT(oc.start_date, '%Y-%m-%d') as start_date,
    		   DATE_FORMAT(oc.end_date, '%Y-%m-%d') as end_date,
    		   oc.content,
    		   oc.type,
    		   oc.del_yn,
    		   oc.update_dt,
    		   oc.reg_dt,
    		   oc.user_id,
    		   oc.reg_user_id,
    		   u.user_name,
    		   CASE WHEN u.position = 0 THEN 'CEO'
			        WHEN u.position = 1 THEN '팀장'
			        WHEN u.position = 2 THEN '파트장'
			        ELSE '매니저'
			    END AS position_name,
			  u.department
			FROM tb_operate_calendar oc
			JOIN tb_user u
			ON u.user_id = oc.user_id 
			WHERE DATE_FORMAT(oc.start_date, '%Y-%m-%d') = #{today}
    </select>
	
	<insert id="OperateScheduleSave">
        INSERT INTO tb_operate_calendar
    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        idx,
	        start_date,
	        end_date,
	        content,
	        type,
	        update_dt,
	        reg_dt,
	        del_yn,
	        user_id,
	        reg_user_id
	    </trim>
	    
	    VALUES
	    
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	    	#{idx},
	    	DATE_FORMAT(#{start_date}, '%Y-%m-%d'),
	        DATE_FORMAT(#{end_date}, '%Y-%m-%d'),
	        #{content},
	        #{type},
	        DATE_FORMAT(now(), '%Y-%m-%d'),
	        DATE_FORMAT(#{reg_dt}, '%Y-%m-%d'),
	        #{del_yn},
	        #{user_id},
	        #{reg_user_id}
	    </trim>
	    
	    ON DUPLICATE KEY UPDATE
	    <trim suffixOverrides=",">
	    	idx=#{idx},
	        start_date=DATE_FORMAT(#{start_date}, '%Y-%m-%d'),
	        end_date=DATE_FORMAT(#{end_date}, '%Y-%m-%d'),
	        content=#{content},
	        type=#{type},
	        update_dt=DATE_FORMAT(now(), '%Y-%m-%d'),
	        reg_dt=DATE_FORMAT(#{reg_dt}, '%Y-%m-%d'),
	        del_yn=#{del_yn},
	        user_id=#{user_id},
	        reg_user_id=#{reg_user_id}
	    </trim>
    </insert>
</mapper>